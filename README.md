# Многопоточный https-сервер
## возможности

- **многопоточность**: пул потоков для одновременной обработки запросов
- **http/1.1**: поддержка базового http-протокола
- **ssl/tls**: поддержка https с самоподписанными сертификатами
- **защита от ddos**: примитивная защита от атак с ограничением соединений и rate limiting

## требования

- **rust**: версия 1.70.0 или выше
- **openssl**: должен быть установлен в системе для генерации сертификатов
- **ос**: windows, macos, linux

## установка и запуск

### 1. клонирование репозитория

```bash
git clone <your-repo-url>
cd rserver
```

### 2. сборка проекта

```bash
# сборка в режиме отладки
cargo build

# сборка в релизном режиме (оптимизированная)
cargo build --release
```

### 3. генерация ssl сертификата (обязательно для https)

для запуска https-сервера вам потребуется ssl-сертификат. вы можете сгенерировать самоподписанный сертификат с помощью одного из скриптов:

*   **windows (powershell, запустить от имени администратора):**
    ```bash
    ./generate_cert.ps1
    ```
*   **linux/macos:**
    ```bash
    chmod +x generate_cert.sh
    ./generate_cert.sh
    ```
после выполнения скрипта в корне проекта должна появиться папка `certs` с файлами `key.pem` и `cert.pem`.

### 4. запуск сервера

запуск сервера с поддержкой https:

```bash
# запуск из папки проекта
cargo run -- --https

# или запуск собранного исполняемого файла
./target/debug/rserver.exe --https  # windows
./target/debug/rserver --https      # linux/macos
```

сервер будет доступен по адресу: **https://127.0.0.1:8443**

*примечание: браузер будет показывать предупреждение о безопасности, так как сертификат самоподписанный. это нормально для тестовой среды.*

## доступные маршруты

| маршрут | описание | статус |
|---|---|---|
| `/` | главная страница | 200 ok |
| `/sleep` | страница с задержкой (5 сек) | 200 ok |
| `/*` | любой другой маршрут | 404 not found |

## структура проекта

rserver/
├── certs/ # папка для ssl сертификатов (key.pem, cert.pem)
├── src/
│ ├── lib.rs # библиотека с пулом потоков и логикой ddos-защиты
│ └── main.rs # основной http/https сервер
├── 404.html # страница ошибки 404
├── darkprince.html # главная страница
├── cargo.toml # зависимости и настройки
├── readme.md # этот файл
├── generate_cert.ps1 # powershell скрипт для генерации сертификата
└── generate_cert.sh # bash скрипт для генерации сертификата

## устранение неполадок

### ошибка "address already in use"

```bash
# остановите процесс, использующий порт 8443 (для https) или 7878 (для http)
# windows:
netstat -ano | findstr :8443
taskkill /pid <pid> /f

# linux/macos:
lsof -i :8443
kill -9 <pid>
```

### ошибка "permission denied"

```bash
# запустите от имени администратора или используйте другой порт (>1024)
```

### сервер не отвечает

1.  проверьте, что сервер запущен: `cargo run -- --https`
2.  убедитесь, что порт 8443 свободен
3.  проверьте файрвол/антивирус

## производительность

- **потоки**: 4 рабочих потока по умолчанию
- **соединения**: обрабатывает множественные одновременные соединения
- **память**: ~5-10mb на поток
- **задержка**: <1ms для статических файлов

## защита от ddos

сервер включает базовую защиту от ddos-атак:

- **ограничение соединений**: максимум 10 одновременных соединений с одного ip
- **rate limiting**: максимум 60 запросов в минуту с одного ip
- **автоблокировка**: ip автоматически блокируется на 5 минут при превышении лимитов
- **очистка**: автоматическая очистка устаревших данных и блокировок

### настройка защиты

отредактируйте структуру `connectiontracker` в `src/lib.rs`:

```rust
max_connections_per_ip: 10,        // количество соединений
max_requests_per_minute: 60,       // запросов в минуту
block_duration: duration::from_secs(300), // время блокировки
```

## P.S
по ограничениям безопасности - нет аутентификации и связи с БД, самоподписанные сертификаты. На этом все